<!DOCTYPE html>
<html lang="es">
<head>
<meta name="google-site-verification" content="myBcnOWByarVwV4a5_MfZoFnzrMgCgu0cjO9gy80CN0" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GLW3B4MTLH"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GLW3B4MTLH');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Calcula cuánto dinero puedes acumular invirtiendo cada mes. Simulador de inversión a largo plazo con interés compuesto e inflación.">

<title>Simulador de Inversión | Fynantium</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  
<style>
/* --- TU CSS ACTUAL --- */
/* Lo dejamos igual, el CSS no cambia */
* { box-sizing: border-box; margin: 0; padding: 0; font-family: inherit; }
/* ... resto del CSS que ya tienes ... */
</style>
</head>

<body>

<div class="logo">
  <a href="https://fynantium.com">
    <img src="assets/logo-fynantium.png" alt="Fynantium">
  </a>
</div>

<div class="container">

    <div class="title-wrapper">
        <div class="title-plate">
            <h1>Simulador de Inversión</h1>
        </div>
    </div>

    <div class="inputs">
        <div class="input-group">
        <label>Aportación mensual</label>
        <div class="input-wrapper">
            <input type="text" id="monthly" value="300">
            <span class="input-suffix">€</span>
        </div>
    </div>
       
        <div class="input-group">
        <label>Años de inversión</label>
        <div class="input-wrapper">
            <input type="number" id="years" value="20">
            <span class="input-suffix">años</span>
        </div>
    </div>

        <div class="input-group">
            <label>Rentabilidad anual (%)</label>
            <input type="number" value="8" disabled>
        </div>

        <div class="input-group">
            <label>Inflación anual (%)</label>
            <input type="number" value="2" disabled>
        </div>
    </div>

    <div class="note">
        Rentabilidad media anual 8% · Inflación media anual 2%
    </div>

    <div class="btn-wrapper">
    <button class="btn" onclick="calculate()">Calcular proyección</button>
    </div>

    <div class="results" id="results">
        <div class="results-grid">
            <div class="metric">
                <h3>Total aportado</h3>
                <p id="totalInvested">-</p>
            </div>
            <div class="metric">
                <h3>Intereses generados</h3>
                <p id="interestEarned">-</p>
            </div>
            <div class="metric">
                <h3>Capital final</h3>
                <p id="finalCapital">-</p>
            </div>
            <div class="metric">
                <h3>Valor real ajustado a inflación</h3>
                <p id="realCapital">-</p>
            </div>
            <div class="metric pro-locked">
            <h3>
                Rentabilidad anualizada
            </h3>
            <a href="simuladordeinversion/pro.html" class="locked-link">Disponible en PRO</a>
        </div>

        </div>

        <div class="chart-container">
            <canvas id="chart"></canvas>
        </div>
        
        <div class="result-explanation" id="resultExplanation">
            
        </div>
        
        <div class="microcopy">
        <p>
            Proyección basada en rendimientos históricos medios del mercado.
        </p>
        <p>
            Esta herramienta es una simulación matemática y no constituye asesoramiento financiero.
        </p>
        </div>
    </div>

    <div class="pro-block">
        <p>
            <a href="simuladordeinversion/pro.html" 
           class="pro-title-link"
           onclick="event.preventDefault(); 
                    gtag('event', 'pro_clicked', {
                      event_category: 'conversion',
                      event_label: 'Click PRO'
                    }); 
                    setTimeout(() => {
                      window.location.href='simuladordeinversion/pro.html';
                    }, 150);">
           Fynantium PRO — Acceso completo al laboratorio
        </a>
        </p>
        <p>
        ¿Y si pudieras comparar distintos escenarios o ajustar la inflación? 
        </p>
        <p>
        Simulación por escenarios, análisis ajustado por inflación y proyecciones avanzadas estarán disponibles próximamente.
        </p>
        <span>Mayor control · Comparación de escenarios · Exportación profesional</span>
    </div>

</div>

<!-- --- BLOQUE DE SCRIPT REEMPLAZADO --- -->
<script>
let chart;
const yearlyIndexes = [];

function formatNumber(value) {
    return value.replace(/\D/g, "").replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

document.getElementById("monthly").addEventListener("input", function() {
    this.value = formatNumber(this.value);
    this.classList.add("changed");
    setTimeout(() => { this.classList.remove("changed"); }, 300);
});

const externalTooltipHandler = (context) => {
    const { chart, tooltip } = context;
    let tooltipEl = document.getElementById('chartjs-tooltip');

    if (!tooltipEl) {
        tooltipEl = document.createElement('div');
        tooltipEl.id = 'chartjs-tooltip';
        tooltipEl.innerHTML = "<div class='tooltip-content'></div>";
        document.body.appendChild(tooltipEl);
    }

    if (tooltip.opacity === 0) {
        tooltipEl.style.opacity = 0;
        tooltipEl.style.transform = "translateY(6px)";
        return;
    }

    const index = tooltip.dataPoints[0].dataIndex;
    if (!yearlyIndexes.includes(index)) {
        tooltipEl.style.opacity = 0;
        return;
    }

    const year = Math.floor((index + 1) / 12);
    const capitalAcumulado = chart.data.datasets[0].data[index];
    const capitalAportado = chart.data.datasets[1].data[index];
    const interesGenerado = capitalAcumulado - capitalAportado;
    const formatCurrency = val => val.toLocaleString("es-ES", { style:"currency", currency:"EUR" });

    tooltipEl.querySelector('.tooltip-content').innerHTML = `
        <div class="tooltip-year">Año ${year}</div>
        <div class="tooltip-row"><span>Capital acumulado</span><span>${formatCurrency(capitalAcumulado)}</span></div>
        <div class="tooltip-row"><span>Capital aportado</span><span>${formatCurrency(capitalAportado)}</span></div>
        <div class="tooltip-divider"></div>
        <div class="tooltip-row highlight"><span>Interés generado</span><span>${formatCurrency(interesGenerado)}</span></div>
    `;

    const canvasPosition = chart.canvas.getBoundingClientRect();
    const tooltipWidth = tooltipEl.offsetWidth;
    const tooltipHeight = tooltipEl.offsetHeight;

    let left = canvasPosition.left + window.pageXOffset + tooltip.caretX + 20;
    let top = canvasPosition.top + window.pageYOffset + tooltip.caretY - tooltipHeight / 2;

    const pageWidth = document.documentElement.clientWidth;
    const pageHeight = document.documentElement.clientHeight;
    if (left + tooltipWidth + 10 > window.pageXOffset + pageWidth) left = canvasPosition.left + window.pageXOffset + tooltip.caretX - tooltipWidth - 20;
    if (top < window.pageYOffset + 10) top = window.pageYOffset + 10;
    if (top + tooltipHeight > window.pageYOffset + pageHeight - 10) top = window.pageYOffset + pageHeight - tooltipHeight - 10;

    tooltipEl.style.left = left + "px";
    tooltipEl.style.top = top + "px";
    tooltipEl.style.opacity = 1;
    tooltipEl.style.transform = "translateY(0px)";
};

const verticalLinePlugin = {
    id: 'verticalLine',
    afterDraw: (chart) => {
        if (chart.tooltip?._active?.length) {
            const ctx = chart.ctx;
            const x = chart.tooltip._active[0].element.x;
            const topY = chart.scales.y.top;
            const bottomY = chart.scales.y.bottom;
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(x, topY);
            ctx.lineTo(x, bottomY);
            ctx.lineWidth = 1;
            ctx.strokeStyle = 'rgba(212,175,55,0.35)';
            ctx.stroke();
            ctx.restore();
        }
    }
};

const glowPlugin = {
    id: 'glow',
    beforeDatasetDraw(chart) {
        const ctx = chart.ctx;
        ctx.save();
        const dataset = chart.data.datasets[0].data;
        const maxValue = dataset[dataset.length-1];
        const intensity = Math.min(maxValue / 150000, 1);
        const blur = 8 + intensity * 14;
        const opacity = 0.18 + intensity * 0.22;
        ctx.shadowColor = `rgba(212,175,55,${opacity})`;
        ctx.shadowBlur = blur;
    },
    afterDatasetDraw(chart) { chart.ctx.restore(); }
};

function calculate() {
    gtag('event', 'calculate_clicked', { event_category: 'engagement', event_label: 'Simulador Free' });

    const btn = document.querySelector(".btn");
    btn.style.opacity = "0.8"; btn.style.pointerEvents = "none";
    setTimeout(()=>{ btn.style.opacity="1"; btn.style.pointerEvents="auto"; }, 600);

    let monthly = parseFloat(document.getElementById("monthly").value.replace(/\./g,"")) || 0;
    if(monthly <= 0) monthly=0;
    let years = parseFloat(document.getElementById("years").value);
    if(isNaN(years)||years<=0) years=1;
    const rate=0.08, inflation=0.02, months=years*12;

    yearlyIndexes.length=0;
    for(let i=0;i<years;i++) yearlyIndexes.push((i+1)*12-1);

    let balance=0, data=[], investedData=[];
    for(let i=1;i<=months;i++){ balance = balance*(1+rate/12)+monthly; data.push(balance); investedData.push(monthly*i); }

    const totalInvested = monthly*months;
    const finalCapital = balance;
    const realCapital = finalCapital / Math.pow(1+inflation, years);
    const interestEarned = finalCapital - totalInvested;

    function animateValue(id,start,end,duration){
        const element=document.getElementById(id); const range=end-start; const startTime=performance.now();
        function update(now){ const elapsed=now-startTime; const progress=Math.min(elapsed/duration,1); element.innerText=(start+range*progress).toLocaleString("es-ES",{style:"currency",currency:"EUR"}); if(progress<1) requestAnimationFrame(update);}
        requestAnimationFrame(update);
    }
    animateValue("totalInvested",0,totalInvested,700);
    animateValue("interestEarned",0,interestEarned,900);
    animateValue("finalCapital",0,finalCapital,900);
    animateValue("realCapital",0,realCapital,900);

    const ctx = document.getElementById("chart").getContext("2d");
    if(chart) chart.destroy();

    chart = new Chart(ctx,{
        type:'line',
        data:{labels:Array.from({length:months},(_,i)=>{if((i+1)%12===0)return i/12+1;return""}),
            datasets:[
                {label:"Capital acumulado", data:data, borderColor:"#d4af37", borderWidth:2.8, fill:false, tension:0.45, cubicInterpolationMode:'monotone', pointRadius:0,
                    segment:{borderColor:ctx=>{
                        const grad=ctx.chart.ctx.createLinearGradient(0,0,ctx.chart.width,0);
                        grad.addColorStop(0,"rgba(212,175,55,0.7)");
                        grad.addColorStop(1,"rgba(212,175,55,1)");
                        return grad;
                    }}
                },
                {label:"Capital aportado", data:investedData, borderColor:"rgba(200,200,200,0.35)", borderWidth:1.4, borderDash:[6,6], fill:false, tension:0.3, pointRadius:0}
            ]
        },
        options:{
            maintainAspectRatio:false,
            animation:{duration:1200,easing:'easeOutQuart'},
            interaction:{mode:'index',intersect:false,axis:'x'},
            hover:{mode:'index',intersect:false},
            plugins:{legend:{display:false},tooltip:{enabled:false,external:externalTooltipHandler}},
            scales:{
                x:{grid:{color:"rgba(255,255,255,0.04)",drawBorder:false},ticks:{color:"rgba(255,255,255,0.5)",font:{size:10},maxTicksLimit: window.innerWidth<768?5:10}},
                y:{grid:{color:"rgba(255,255,255,0.04)",drawBorder:false},ticks:{color:"rgba(255,255,255,0.5)",font:{size:11},callback:function(val){return new Intl.NumberFormat('es-ES',{notation:"compact",maximumFractionDigits:1}).format(val)+" €";}}}
            }
        },
        plugins:[verticalLinePlugin,glowPlugin]
    });

    gtag('event','result_shown',{event_category:'engagement',event_label:'Resultado mostrado'});

    document.getElementById("results").classList.add("visible");
    document.querySelector(".pro-block").classList.add("visible");

    const explanation = `
        Si inviertes <strong>${monthly.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</strong> al mes durante <strong>${years} años</strong>, podrías acumular aproximadamente <span>${finalCapital.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</span>.
        Habrás aportado <strong>${totalInvested.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</strong>, pero <span>${interestEarned.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</span> vendrán del crecimiento de tu dinero con el tiempo.
        Esto es el efecto del interés compuesto: tu dinero empieza a trabajar por ti.
    `;

    const lateScenario = finalCapital*0.7;
    const comparison = `<br><br>Si retrasas esta inversión unos años, podrías terminar con alrededor de <span>${lateScenario.toLocaleString("es-ES",{style:"currency",currency:"EUR"})}</span>.<span>Empezar antes marca una gran diferencia.</span>`;

    document.getElementById("resultExplanation").innerHTML = explanation + comparison;
}
</script>

</body>
</html>
